var P=880,Y=640,O=BigInt(6),p=BigInt(7),E=O*p,F=640/Number(O),U=F,y=0;var R=4,W=5,X=6,h=7,T=1000,i=1000;class j{static images=[];static sounds=[];static loadImage(q,J,Q){let V=new Image;if(V.src=`assets/${q}`,J!==null)V.width=Number(J);if(Q!==null)V.height=Number(Q);return this.images.push(V),this.images.length-1}static loadSound(q,J){return this.sounds.push([new Audio(`assets/${q}`),Math.max(J,0)]),this.sounds.length-1}static percentLoaded(){let q=0,J;for(J=0;J<this.images.length;++J)q+=Number(this.images[J].complete);for(J=0;J<this.sounds.length;++J)q+=Number(this.sounds[J][0].readyState===4);return q/(this.images.length+this.sounds.length)}static playSound(q){if(q<this.sounds.length&&q>=0){const[J,Q]=this.sounds[q];J.currentTime=Q,J.play()}else console.error(`Sound index ${q} out of bounds for ${this.sounds.length} sounds loaded.`)}}class f{static mouseDown;static x;static y;static downX;static downY;static upX;static upY;static shouldHandleMouseEvent;static init(q){this.x=0,this.y=0,this.downX=0,this.downY=0,this.upX=0,this.upY=0,this.mouseDown=!1,this.shouldHandleMouseEvent=!1,q.addEventListener("mousemove",(J)=>{this.x=J.x-q.offsetLeft,this.y=J.y-q.offsetTop}),q.addEventListener("mousedown",(J)=>{this.downX=J.x-q.offsetLeft,this.downY=J.y-q.offsetTop,this.mouseDown=!0}),q.addEventListener("mouseup",(J)=>{this.upX=J.x-q.offsetLeft,this.upY=J.y-q.offsetTop,this.shouldHandleMouseEvent=!0,this.mouseDown=!1})}}class D{canvas;ctx;sceneIndex;scenes;constructor(q,J,Q,V){this.scenes=q,this.sceneIndex=J,this.canvas=document.createElement("canvas"),this.canvas.setAttribute("id","canvas"),this.canvas.setAttribute("width",`${Q}`),this.canvas.setAttribute("height",`${V}`),document.getElementById("canvashere").appendChild(this.canvas),this.ctx=this.canvas.getContext("2d"),f.init(this.canvas);for(let $=0;$<q.length;++$)q[$].canvas=this.canvas}start(){const q=document.createElement("progress");q.max=1,q.value=0,document.getElementById("canvashere").appendChild(q);const J=()=>{if(q.value=j.percentLoaded(),q.value!==1)window.requestAnimationFrame(J);else{q.hidden=!0;let Q=(new Date()).getTime(),V=0;const $=(k)=>{V=k-Q,Q=k;const z=this.scenes[this.sceneIndex].update(V);if(z!==-1)this.sceneIndex=z;this.scenes[this.sceneIndex].render(this.ctx),window.requestAnimationFrame($)};window.requestAnimationFrame($)}};window.requestAnimationFrame(J)}}class C{canvas=null}function b(q,J,Q,V,$,k,z){q.font=$,q.fillStyle=k,q.strokeStyle=z,q.lineWidth=8,q.lineJoin="round",q.miterLimit=2,q.strokeText(J,Q,V),q.fillText(J,Q,V)}class v extends C{playButtonX;playButtonY;playButtonWidth;playButtonHeight;playButtonColor;playButtonRegularColor;playButtonHighlightColor;constructor(){super();this.playButtonX=Y/2-76,this.playButtonY=P/2,this.playButtonWidth=150,this.playButtonHeight=90,this.playButtonRegularColor="#FCD534",this.playButtonHighlightColor="White",this.playButtonColor=this.playButtonRegularColor}update(q){if(f.x>=this.playButtonX&&f.x<=this.playButtonX+this.playButtonWidth&&f.y<=this.playButtonY+15&&f.y>=this.playButtonY-this.playButtonHeight){if(this.playButtonColor=this.playButtonHighlightColor,f.mouseDown)return 1}else this.playButtonColor=this.playButtonRegularColor;return-1}render(q){b(q,"Match 3",10,150,"150px Monaco","#FCD534","White"),b(q,"Play",Y/2-76,P/2,"60px Monaco",this.playButtonColor,"Black");const J=200;q.drawImage(j.images[1],(Y-J)/5,600,J,J),q.drawImage(j.images[0],(Y-F)/2,550)}}function d(q,J){return Math.floor(Math.random()*(J-q+1)+q)}function g(q,J){return Math.random()*(J-q+1)+q}function S(){return Math.sign(Math.random()-0.5)}function m(q){return q>=BigInt(0)?q:BigInt(-q)}function J0(q){const J=q<<K*u&q<<K*r,Q=q&q<<K*u,V=q&J,$=J&q<<K*q0,k=q<<K-Z&J,z=J&q<<K*M-Z,L=q<<K+Z&J,N=J&q<<K*M+Z,t=Q&q<<K+Z,G=Q&q<<K-Z,l=q>>Z&q>>u,o=q&q>>u,x=q<<K&l,s=q<<Z&l,B=q>>K&l,n=q>>r-K&l,a=q>>M&l,_=q>>K+r&l,I=q>>Z-K&o,e=q>>Z+K&o;return(V|$|k|z|L|N|t|G|x|s|B|n|a|_|I|e)>w}var w=BigInt(0),Z=BigInt(1),u=BigInt(2),r=BigInt(3),M=BigInt(4),q0=BigInt(5),K=BigInt(9);class c{boards;constructor(){this.boards=[];for(let q=0;q<h;++q)this.boards.push(w)}clear(){for(let q=0;q<h;++q)this.boards[q]=w}validMoveExists(){for(let q=0;q<h;++q)if(J0(this.boards[q]))return!0;return!1}runSwitch(q,J,Q,V){if(q==Q&&m(J-V)===Z||J==V&&m(q-Q)===Z){const $=Z<<q*K+J,k=Z<<Q*K+V,z=this.getType(q,J),L=this.getType(Q,V);if(this.boards[z]^=$,this.boards[z]|=k,this.boards[L]^=k,this.boards[L]|=$,this.connect3Exists(z)||this.connect3Exists(L))return!0;this.boards[z]|=$,this.boards[z]^=k,this.boards[L]|=k,this.boards[L]^=$}return!1}updateBoard(){if(this.fill())return-1;return this.findConnect3()}getType(q,J){const Q=Z<<q*K+J;for(let V=0;V<h;++V)if((this.boards[V]&Q)!=w)return V;return-1}validMoves(){return[]}fill(){let q=!1,J;for(let Q=w;Q<p;++Q)for(let V=w;V<O;++V){const $=Q+V*K;for(J=0;J<h;++J)if((this.boards[J]&Z<<$)!=w)break;if(J==h)if(q=!0,Q==w){const k=d(0,Number(h)-1);this.boards[k]|=Z<<$}else{const k=Z<<$-Z;for(let z=0;z<h;++z)if((this.boards[z]&k)!=w){this.boards[z]|=Z<<$,this.boards[z]^=k;break}}}return q}findConnect3(){let q,J,Q,V=0;for(let $=0;$<h;++$){const k=this.boards[$],z=k&k<<K&k<<K*u,L=k&k<<Z&k<<u;if(z>0)for(J=w;J<O;++J){let N=J*K;for(Q=w;Q<p;++Q)if(q=N+Q,(z&Z<<q)!==w)this.boards[$]&=~(Z<<q),this.boards[$]&=~(Z<<q-K),this.boards[$]&=~(Z<<q-u*K),V+=3}if(L>0)for(J=w;J<O;++J){let N=J*K;for(Q=w;Q<p;++Q)if(q=N+Q,(L&Z<<q)!==w)this.boards[$]&=~(Z<<q),this.boards[$]&=~(Z<<q-Z),this.boards[$]&=~(Z<<q-u),V+=3}if(V>0)break}return V}connect3Exists(q){const J=this.boards[q];return(J&J<<Z&J<<u)>0||(J&J<<K&J<<K*u)>0}print(q){const J=this.boards[q];for(let Q=BigInt(0);Q<BigInt(7);++Q){let V="";for(let $=BigInt(0);$<BigInt(6);++$){const k=$*BigInt(9)+Q;if((J&BigInt(1)<<k)!=BigInt(0))V+="1";else V+="0"}console.log(V)}}}class A{particles;acceleration;elapsed;constructor(q){this.elapsed=0,this.particles=[],this.acceleration=[];for(let J=0;J<q;++J)this.particles.push([0,0]),this.acceleration.push([0,0])}reset(){this.elapsed=0;const q=this.particles.length;for(let J=0;J<q;++J)this.particles[J][0]=Y/2,this.particles[J][1]=P/2,this.acceleration[J][0]=g(0.1,10)*S(),this.acceleration[J][1]=g(0.1,10)*S()}update(q){const J=this.particles.length;for(let Q=0;Q<J;++Q)this.particles[Q][0]+=this.acceleration[Q][0],this.particles[Q][1]+=this.acceleration[Q][1];return this.elapsed+=q,this.elapsed>i}render(q){const J=this.particles.length;q.fillStyle="white";for(let Q=0;Q<J;++Q)q.beginPath(),q.arc(this.particles[Q][0],this.particles[Q][1],10,0,2*Math.PI),q.fill()}}class H extends C{brd;state;score;timeOut;explosion;constructor(){super();this.brd=new c,this.state=R,this.score=0,this.timeOut=0,this.explosion=new A(T)}render(q){q.drawImage(j.images[j.images.length-1],0,0,Y,P);let J,Q;const[V,$,k,z]=this.getMouseCoordinated();for(J=0;J<p;++J)for(Q=0;Q<O;++Q){const N=this.brd.getType(BigInt(Q),BigInt(J));if(N==-1)continue;if(f.mouseDown&&V==Q&&$==J)continue;q.drawImage(j.images[N],Q*F,(J+1)*U,F,U)}if(f.mouseDown){const N=this.brd.getType(BigInt(V),BigInt($));if(N!==-1)q.drawImage(j.images[N],f.x-F/2,f.y-U/2,F,U)}if(this.state===X)this.explosion.render(q);const L=`Score: ${this.score}`;q.fillStyle="white",q.font="40px monospace",q.fillText(L,Y/2.7,U/2)}update(q){switch(this.state){case R:this.checkBoardState();break;case W:this.timeOutState(q);break;case y:this.playerState();break;case X:this.explosionState(q);break;default:console.error(`Unhandled state '${this.state}'. The game is ruined.`);break}return-1}checkBoardState(){const q=this.brd.updateBoard();if(q===0)if(this.brd.validMoveExists())this.state=y;else this.brd.clear(),this.score+=Number(E),this.state=X,this.explosion.reset(),j.playSound(4);else if(this.score+=Math.max(0,q),this.timeOut=25,this.state=W,q!==-1)j.playSound(0)}timeOutState(q){if(this.timeOut<=0)this.state=R;else this.timeOut-=q}playerState(){if(f.shouldHandleMouseEvent){f.shouldHandleMouseEvent=!1;const[q,J,Q,V]=this.getMouseCoordinated();if(this.brd.runSwitch(BigInt(q),BigInt(J),BigInt(Q),BigInt(V)))this.timeOut=500,this.state=W}}explosionState(q){if(this.explosion.update(q))this.timeOut=250,this.state=W}getMouseCoordinated(){return[Math.floor(f.downX/F),Math.floor(f.downY/U)-1,Math.floor(f.upX/F),Math.floor(f.upY/U)-1]}}(()=>{j.loadImage("apple.png",Number(F),Number(U)),j.loadImage("bread.png",Number(F),Number(U)),j.loadImage("coconut.png",Number(F),Number(U)),j.loadImage("broccoli.png",Number(F),Number(U)),j.loadImage("milk.png",Number(F),Number(U)),j.loadImage("orange.png",Number(F),Number(U)),j.loadImage("star.png",Number(F),Number(U)),j.loadImage("bg.png",null,null),j.loadSound("success_1.wav",0),j.loadSound("success_2.wav",0),j.loadSound("success_3.wav",0),j.loadSound("success_4.wav",0),j.loadSound("explosion.wav",0),new D([new v,new H],0,Y,P).start()})();
